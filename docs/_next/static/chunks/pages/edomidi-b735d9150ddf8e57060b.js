(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[575],{5458:function(e,n,t){"use strict";t.r(n);var r=t(4121),i=t(4047),a=t(2700),o=t(6265),u=t(9999),c=t(5893),s=(t(8573),t(7294)),l=t(7423);function d(e,n){var t;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=function(e,n){if(!e)return;if("string"===typeof e)return f(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return f(e,n)}(e))||n&&e&&"number"===typeof e.length){t&&(e=t);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return o=e.done,e},e:function(e){u=!0,a=e},f:function(){try{o||null==t.return||t.return()}finally{if(u)throw a}}}}function f(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function v(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var y=["Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash"],h={attack:{label:"Attack (s)",mapping:function(e){return(10*Math.exp(.0206*e)-10)/6.342},round:!1,device:"synth",assign:function(e,n){e.envelope.attack=n,e.modulationEnvelope.attack=n}},release:{label:"release",mapping:function(e){return(10*Math.exp(.0206*e)-10)/3.9635},round:!1,device:"synth",assign:function(e,n){e.envelope.release=n,e.modulationEnvelope.release=n}},modulation:{label:"modulation",mapping:function(e){return e/127*1e3},round:!0,device:"synth",assign:function(e,n){return e.modulationIndex.value=n}},reverb:{label:"reverb",mapping:function(e){return e/127},round:!1,device:"reverb",assign:function(e,n){return e.wet.value=n}},feedback:{label:"feedback",mapping:function(e){return e/127},round:!1,device:"delay",assign:function(e,n){e.feedback.value=n}},time:{label:"time",mapping:function(e){return(10*Math.exp(.0206*e)-10)/12.68},round:!1,device:"delay",assign:function(e,n){return e.delayTime.value=n}},lowpass:{label:"lowpass",mapping:function(e){return 157.48*(Math.exp(.038205*e)-1)},round:!0,device:"lowpass",assign:function(e,n){return e.frequency.value=n}},stereo:{label:"stereo",mapping:function(e){return e/127},round:!1,device:"stereo",assign:function(e,n){return e.width.value=n}}},g=function(e){var n=e.label,t=e.displayValue,r=e.input,i=e.setInput,a=e.midiInput,o=e.changeParameter;return(0,c.jsxs)("div",{children:[(0,c.jsx)("p",{children:n}),(0,c.jsx)("span",{children:t}),(0,c.jsx)("input",{type:"range",min:"0",max:"127",value:r,className:"slider",onChange:function(e){return i(Number(e.target.value))}}),(0,c.jsx)("button",{className:"midimap",onClick:o,children:a?"set"===a?"move knob":"= ".concat(a):"midi map"})]})};n.default=function(){var e=(0,s.useRef)(null),n=(0,s.useState)(),t=n[0],r=n[1],i=(0,s.useState)(),a=i[0],d=i[1],f=(0,s.useState)(null),p=f[0],b=f[1],w=(0,s.useState)({attack:30,release:50,modulation:6,reverb:40,feedback:12,time:60,lowpass:80,stereo:63.5}),j=w[0],x=w[1],k=(0,s.useState)(),S=k[0],D=k[1],K=(0,s.useState)([{},{}]),O=K[0],E=K[1],M=(0,s.useState)(),I=M[0],N=M[1],P=isNaN(t)||isNaN(a)||a<1||a>36||t<1,A=[],C=2*a;if(!P)for(var _=0,q=(0,u.Z)(Array(C).keys());_<q.length;_++){var Z=q[_];0===Z?A.push(t):A.push(Math.pow(2,1/a)*A[Z-1])}var L=function(e){var n=e.input,t=e.value;if(S){var r=v(v({},O[0]),{},(0,o.Z)({},S,n)),i=Object.keys(r).reduce((function(e,n){return v(v({},e),{},(0,o.Z)({},r[n],e[r[n]]?e[r[n]].concat([n]):[n]))}),{}),a=[r,i];E(a),D(void 0),localStorage.midiMap=JSON.stringify(a)}else{var u=O[1][n];if(u){var c=v({},j);u.forEach((function(e){return c[e]=t})),x(c)}}};return(0,s.useEffect)((function(){if(e.current){console.log("setting message callback");var n=L;window.onDeviceInput=n,e.current.onDeviceInput=n}}),[S,j,O]),(0,s.useEffect)((function(){if(p||b(function(){var e=new l.S9(.8),n=new l.S9(.8),t=new l.E8({wet:.6,decay:30}),r=new l.D0({time:.1,feedback:.7,wet:.5}),i=new l.wn(2e3,"lowpass"),a=new l.Z2(.5);return e.connect(t),t.connect(r),r.connect(i),i.connect(a),a.connect(n),n.toDestination(),{synth:new l.tC({oscillator:{type:"sine"},modulationIndex:10,modulation:{type:"sawtooth"},modulationEnvelope:{attack:5,release:9},envelope:{attack:3,decay:3,sustain:.8,release:8,attackCurve:"sine"}}).connect(e),lowpass:i,stereo:a,delay:r,reverb:t,outmix:n}}()),!e.current){var n=new m;n.start().then((function(){console.log("Started!")})).catch(console.error),e.current=n}if(localStorage.midiMap){var t=JSON.parse(localStorage.midiMap);E(t)}navigator&&navigator.keyboard&&navigator.keyboard.getLayoutMap().then((function(e){N(e)}))}),[]),(0,s.useEffect)((function(){var e=function(e){console.log(e.code);var n=y.indexOf(e.code);-1!==n&&n<A.length&&p.synth.triggerAttack(A[n])},n=function(e){return p.synth.triggerRelease()};return document.addEventListener("keydown",e),document.addEventListener("keyup",n),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",n)}}),[A,p]),(0,c.jsxs)("div",{children:[(0,c.jsxs)("form",{name:"edo-cal",children:[(0,c.jsxs)("span",{children:[(0,c.jsx)("i",{children:" f"}),(0,c.jsx)("sub",{children:"0"})," (Hz)"]}),(0,c.jsx)("input",{name:"f0",id:"f0",type:"text",placeholder:"e.g 110",size:"10",required:!0,onChange:function(e){return r(Number(e.target.value))}}),(0,c.jsx)("span",{children:"divisions"}),(0,c.jsx)("input",{name:"divisions",type:"text",placeholder:"max: 36",size:"10",required:!0,onChange:function(e){return d(Number(e.target.value))}}),P&&(0,c.jsx)("p",{children:"enter a valid number in both boxes"})]}),(0,c.jsx)("br",{}),(0,c.jsxs)("div",{className:"field",children:[(0,c.jsx)("span",{children:"oscillator2"}),(0,c.jsxs)("select",{id:"oscillator-type",onChange:function(e){return p.synth.oscillator.type=e.target.value},children:[(0,c.jsx)("option",{value:"sine",children:"sine"}),(0,c.jsx)("option",{value:"triangle",children:"triangle"}),(0,c.jsx)("option",{value:"sawtooth",children:"sawtooth"}),(0,c.jsx)("option",{value:"square",children:"square"})]})]}),(0,c.jsxs)("div",{className:"slidecontainer",children:[Object.keys(h).map((function(e){var n=h[e],t=n.label,r=n.mapping,i=n.round,a=n.device,u=n.assign,s=j[e],l=r(s);p&&u(p[a],l);var d=i?Math.round(l):l.toFixed(2);return(0,c.jsx)(g,{label:t,displayValue:d,input:s,setInput:function(n){x(v(v({},j),{},(0,o.Z)({},e,n)))},midiInput:S&&S===e?"set":O[0][e],changeParameter:function(){return D(e)}},e)})),(0,c.jsx)("button",{onClick:function(){E([{},{}]),localStorage.removeItem("midiMap")},children:"Clear midi map"})]}),(0,c.jsx)("div",{id:"container",children:A.map((function(e,n){return(0,c.jsx)("div",{className:"note",onMouseDown:function(){return p.synth.triggerAttack(e)},onMouseUp:function(){return p.synth.triggerRelease()},onMouseLeave:function(){return p.synth.triggerRelease()},children:(0,c.jsx)("span",{children:I.get(y[n])})},e)}))}),(0,c.jsx)("footer",{children:"\xa9 Richard Hughes 2021"})]})};var m=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.Z)(this,e),this.onDeviceInput=n.onDeviceInput||console.log}return(0,a.Z)(e,[{key:"start",value:function(){var e=this;return new Promise((function(n,t){e._requestAccess().then((function(t){e.initalize(t),n()})).catch((function(){return t("Something went wrong.")}))}))}},{key:"initalize",value:function(e){var n,t=d(e.inputs.values());try{for(t.s();!(n=t.n()).done;){var r=n.value;this.initalizeDevice(r)}}catch(i){t.e(i)}finally{t.f()}}},{key:"initalizeDevice",value:function(e){e.onmidimessage=this.onMessage.bind(this)}},{key:"onMessage",value:function(e){var n=(0,r.Z)(e.data,3),t=(n[0],n[1]),i=n[2];this.onDeviceInput({input:t,value:i})}},{key:"_requestAccess",value:function(){return new Promise((function(e,n){navigator.requestMIDIAccess?navigator.requestMIDIAccess().then(e).catch(n):n()}))}}]),e}()},2222:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/edomidi",function(){return t(5458)}])}},function(e){e.O(0,[400,774,888,179],(function(){return n=2222,e(e.s=n);var n}));var n=e.O();_N_E=n}]);